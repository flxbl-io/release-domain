name: "Release Domain"
description: "Deploy a release candidate to a target environment with locking"
author: "flxbl-io"

branding:
  icon: "upload-cloud"
  color: "green"

inputs:
  sfp-server-url:
    description: "URL to the SFP Server instance (e.g., https://your-org.flxbl.io)"
    required: true
  sfp-server-token:
    description: "Token for SFP Server authentication"
    required: true
  environment:
    description: "Target environment name to deploy to"
    required: true
  release-candidate:
    description: "Name of the release candidate to deploy"
    required: true
  domain:
    description: "Domain (release config name) of the release candidate"
    required: true
  repository:
    description: "Repository name (format: owner/repo)"
    required: false
    default: ${{ github.repository }}
  devhub-alias:
    description: "Alias for the DevHub org (needed for unlocked package installations)"
    required: false
    default: "devhub"
  wait-time:
    description: "Wait time in minutes for package installation"
    required: false
    default: "120"
  tag:
    description: "Tag the release for identification in metrics"
    required: false
    default: ""
  exclude-packages:
    description: "Comma-separated list of packages to exclude from deployment (e.g., 'pkg-a,pkg-b')"
    required: false
    default: ""
  override-packages:
    description: "Comma-separated package version overrides (e.g., 'pkg-a=1.2.3,pkg-b=2.0.0')"
    required: false
    default: ""
  lock:
    description: "Lock environment before release (auto-unlock on completion)"
    required: false
    default: "true"
  lock-timeout:
    description: "Minutes to wait for lock acquisition (0 = wait indefinitely)"
    required: false
    default: "15"
  lock-duration:
    description: "Duration in minutes to hold the lock"
    required: false
    default: "120"
  dry-run:
    description: "Dry-run mode (no lock, no deploy)"
    required: false
    default: "false"

outputs:
  deployment-status:
    description: "Status of the deployment (success/failed)"
  ticket-id:
    description: "Lock ticket ID (if locking was enabled)"

runs:
  using: "node20"
  main: "dist/index.js"
  post: "dist/cleanup.js"
  post-if: "always()"
